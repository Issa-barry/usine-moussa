<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="card">
  <div class="flex flex-column sm:flex-row sm:align-items-center sm:justify-content-between py-5">
    <span class="text-900 text-xl font-bold mb-4 block">Informations du contact client</span>
    <div class="flex flex-wrap gap-2">
      <ng-container *ngIf="!loadingContact; else skeletonActions">
        <button pButton icon="pi pi-pencil" label="Modifier" class="p-button-outlined p-button-primary" (click)="toggleEditMode()" *ngIf="!isEditing"></button>
        <button pButton icon="pi pi-check" label="Enregistrer" class="p-button-success" (click)="saveClient()" *ngIf="isEditing"></button>
        <button pButton icon="pi pi-times" label="Annuler" class="p-button-secondary" (click)="toggleEditMode()" *ngIf="isEditing"></button>
      </ng-container>
      <ng-template #skeletonActions>
        <p-skeleton width="130px" height="2.5rem"></p-skeleton>
        <p-skeleton width="170px" height="2.5rem"></p-skeleton>
      </ng-template>
    </div>
  </div>

  <p-progressBar *ngIf="loading" mode="indeterminate" class="mb-4"></p-progressBar>

  <div class="grid formgrid p-fluid" *ngIf="!loading">
    <!-- Civilité -->
    <div class="field col-6 md:col-6">
      <label class="font-medium">Civilité</label>
      <p-skeleton *ngIf="loadingContact" width="100%" height="2.5rem"></p-skeleton>
      <p-dropdown *ngIf="!loadingContact" [(ngModel)]="contact.civilite" [options]="civiliteOptions" optionLabel="label" optionValue="value" [disabled]="!isEditing"
        [ngClass]="{ 'ng-invalid ng-dirty': (submitted && !contact.civilite) || errors['civilite'] }">
      </p-dropdown>
      <small *ngIf="errors['civilite']" class="text-red-500">{{ errors["civilite"] }}</small>
    </div>

    <!-- Téléphone -->
    <div class="field col-6 md:col-6">
      <label class="font-medium">Téléphone</label>
      <p-skeleton *ngIf="loadingContact" width="100%" height="2.5rem"></p-skeleton>
      <input *ngIf="!loadingContact" pInputText [(ngModel)]="contact.phone" [disabled]="!isEditing"
        [ngClass]="{ 'ng-invalid ng-dirty': (submitted && !contact.phone) || errors['phone'] }" />
      <small *ngIf="errors['phone']" class="text-red-500">{{ errors["phone"] }}</small>
    </div>

    <!-- Nom complet -->
    <div class="field col-12">
      <label class="font-medium">Nom complet</label>
      <p-skeleton *ngIf="loadingContact" width="100%" height="2.5rem"></p-skeleton>
      <input *ngIf="!loadingContact" pInputText [(ngModel)]="contact.nom_complet" [disabled]="!isEditing"
        [ngClass]="{ 'ng-invalid ng-dirty': (submitted && !contact.nom_complet) || errors['nom_complet'] }" />
      <small *ngIf="errors['nom_complet']" class="text-red-500">{{ errors["nom_complet"] }}</small>
    </div>

    <!-- Adresse complète -->
    <div class="field col-6">
      <label class="font-medium">Quartier</label>
      <p-skeleton *ngIf="loadingContact" width="100%" height="2.5rem"></p-skeleton>
      <input *ngIf="!loadingContact" pInputText [(ngModel)]="contact.adresse.adresse" [disabled]="!isEditing"
        [ngClass]="{ 'ng-invalid ng-dirty': (submitted && !contact.adresse.adresse) || errors['adresse.adresse'] }" />
      <small *ngIf="errors['adresse.adresse']" class="text-red-500">{{ errors["adresse.adresse"] }}</small>
    </div>

    <div class="field col-6 md:col-6">
      <label class="font-medium">Ville</label>
      <p-skeleton *ngIf="loadingContact" width="100%" height="2.5rem"></p-skeleton>
      <input *ngIf="!loadingContact" pInputText [(ngModel)]="contact.adresse.ville" [disabled]="!isEditing"
        [ngClass]="{ 'ng-invalid ng-dirty': (submitted && !contact.adresse.ville) || errors['adresse.ville'] }" />
      <small *ngIf="errors['adresse.ville']" class="text-red-500">{{ errors["adresse.ville"] }}</small>
    </div>
  </div>
</div>
